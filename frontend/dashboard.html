<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard | Yapay Zeka Destekli Migren GÃ¼nlÃ¼ÄŸÃ¼</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/main.css">
</head>
<body>
  <div class="floating-elements">
    <div class="floating-circle circle1"></div>
    <div class="floating-circle circle2"></div>
    <div class="floating-circle circle3"></div>
  </div>
  <header>
    <div class="container">
      <nav>
        <a href="index.html" class="logo">Migren GÃ¼nlÃ¼ÄŸÃ¼</a>
        <ul class="nav-links">
          <li><a href="index.html">Ana Sayfa</a></li>
          <li><a href="about.html">HakkÄ±mÄ±zda</a></li>
          <li><a href="signup.html">KayÄ±t Ol</a></li>
          <li><a href="dashboard.html">Dashboard</a></li>
          <li><a href="panel.html">GÃ¼nlÃ¼k GiriÅŸ</a></li>
          <li><a href="gecmis.html">GeÃ§miÅŸ</a></li>
          <li><a href="grafikler.html">Grafikler</a></li>
          <li><a href="ayarlar.html">Ayarlar</a></li>
          <li><a href="profile.html">Profil</a></li>
        </ul>
      </nav>
    </div>
  </header>
  <main>
    <section class="dashboard-section">
      <h1 id="welcomeMessage">HoÅŸ Geldiniz!</h1>
      <div class="summary-grid">
        <div class="summary-card">
          <div class="summary-icon">ğŸ§ </div>
          <h3>Son Atak</h3>
          <p id="lastAttack">YÃ¼kleniyor...</p>
        </div>
        <div class="summary-card">
          <div class="summary-icon">ğŸ“…</div>
          <h3>Toplam GÃ¼nlÃ¼k</h3>
          <p id="totalEntries">YÃ¼kleniyor...</p>
        </div>
        <div class="summary-card">
          <div class="summary-icon">ğŸ“ˆ</div>
          <h3>En SÄ±k Tetikleyici</h3>
          <p id="primaryTrigger">YÃ¼kleniyor...</p>
        </div>
        <div class="summary-card">
          <div class="summary-icon">ğŸ’¡</div>
          <h3>AI Ã–nerisi</h3>
          <ul id="aiRecommendation">YÃ¼kleniyor...</ul>
        </div>
      </div>
      <div class="cta-center"><a href="panel.html" class="cta-button">Yeni GÃ¼nlÃ¼k GiriÅŸi Yap</a></div>
    </section>
  </main>
  <script src="js/main.js"></script>
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    loadDashboardData();
  });
  async function loadDashboardData() {
    // âœ… VERÄ°LERÄ° BEKLE
    const entries = await MigrenApp.DataManager.getEntries();
    const recentEntries = await MigrenApp.DataManager.getRecentEntries(30);

    // ğŸ‘‹ HoÅŸ geldin mesajÄ±
    const user = MigrenApp.UserManager.getCurrentUser();
    const welcomeMessage = document.getElementById('welcomeMessage');
    if (user) {
      welcomeMessage.textContent = `HoÅŸ Geldiniz, ${user.name || 'KullanÄ±cÄ±'}!`;
    }

    // ğŸ§¾ Toplam kayÄ±t
    document.getElementById('totalEntries').textContent = `${entries.length} kayÄ±t`;

    // ğŸ•’ Son atak
    const lastAttack = document.getElementById('lastAttack');
    if (entries.length > 0) {
      const lastEntry = entries[entries.length - 1];
      const daysAgo = Math.floor((new Date() - new Date(lastEntry.created_at)) / (1000 * 60 * 60 * 24));
      lastAttack.textContent = daysAgo === 0 ? 'BugÃ¼n' : `${daysAgo} gÃ¼n Ã¶nce`;
    } else {
      lastAttack.textContent = 'HenÃ¼z kayÄ±t yok';
    }

    // âš¡ En sÄ±k tetikleyici
   // âš¡ En sÄ±k tetikleyici (backend Ã¼zerinden)
  const primaryTrigger = document.getElementById('primaryTrigger');
  try {
   const summary = await MigrenApp.AnalysisManager.getSummary(30);
  const triggerMap = {
    bright_light: "Parlak IÅŸÄ±k",
    irregular_meals: "DÃ¼zensiz Beslenme",
    weather_change: "Hava DeÄŸiÅŸikliÄŸi"
  };
  const label = triggerMap[summary.primary_trigger] || "Belirlenemedi";
  primaryTrigger.textContent = label;
} catch (e) {
  console.error("Tetikleyici alÄ±namadÄ±:", e);
  primaryTrigger.textContent = "YÃ¼klenemedi";
}


    // ğŸ¤– AI Ã¶nerisi (gerÃ§ek backend analizi ile)
const aiRecommendation = document.getElementById('aiRecommendation');

if (entries.length > 0) {
  try {
    const summary = await MigrenApp.AnalysisManager.getSummary(30);
    const suggestions = summary.recommendations;

    aiRecommendation.innerHTML = suggestions.length > 0
      ? suggestions.map(s => `<li>${s}</li>`).join("")
      : "<li>Her ÅŸey yolunda!</li>";

  } catch (error) {
    console.error("AI Ã¶nerisi alÄ±namadÄ±:", error);
    aiRecommendation.textContent = "AI Ã¶nerisi alÄ±namadÄ±.";
  }
} else {
  aiRecommendation.textContent = "Veri giriÅŸi yapÄ±n";
}

  }
</script>

</body>
</html> 